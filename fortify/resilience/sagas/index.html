
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Robust application chassis for building resilient, observable, and scalable microservices in Python.">
      
      
        <meta name="author" content="Nala Minds">
      
      
        <link rel="canonical" href="https://guandaline.github.io/nala-core-api/fortify/resilience/sagas/">
      
      
        <link rel="prev" href="../backoff/">
      
      
        <link rel="next" href="../adaptive_throttling/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Sagas - Nala Core API</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sagas-for-distributed-transactions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Nala Core API" class="md-header__button md-logo" aria-label="Nala Core API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nala Core API
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sagas
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/guandaline/nala-core-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    guandaline/nala-core-api
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../architecture/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../lifecycle/" class="md-tabs__link">
          
  
  
  Fortify Layer

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Nala Core API" class="md-nav__button md-logo" aria-label="Nala Core API" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Nala Core API
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/guandaline/nala-core-api" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    guandaline/nala-core-api
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/dependency-injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependency Injection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/fortify-layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fortify Layer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/domain-layer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Domain Layer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Fortify Layer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Fortify Layer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Core & Lifecycle
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Core & Lifecycle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lifecycle Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plugin System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Configuration & Context
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Configuration & Context
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration Schemas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/live_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Live Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credential Resolution
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Data & Persistence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Data & Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Connection Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/documents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Stores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/kvstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Key-Value Stores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/outbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Transactional Outbox
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/migrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Migrations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/secrets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secrets Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cryptography
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Structured Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/tracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Tracing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health & Readiness
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lineage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Lineage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cross-Cutting Concerns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Cross-Cutting Concerns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../serializer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serializer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../payload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Payload Compression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Notifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal Event Bus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../http/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Client
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/feature_flags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Feature Flags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../control/scheduler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Task Scheduler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Performance
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/cache/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caching
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/compression_middleware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Compression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../performance/bootstrap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bootstrap (uvloop)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Integration Layer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Integration Layer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9_1" >
        
          
          <label class="md-nav__link" for="__nav_3_9_1" id="__nav_3_9_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Messaging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_9_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9_1">
            <span class="md-nav__icon md-icon"></span>
            Messaging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/producer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Producer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/consumer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consumer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/retry-dlq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retry & DLQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/delay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Delayed Messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/context-propagation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Propagation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/messaging/internals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internals & Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/outbox_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outbox Publisher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Background Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Service Discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/consul/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Consul Client
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/config_providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dynamic Config Providers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integration/openlineage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenLineage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_10" checked>
        
          
          <label class="md-nav__link" for="__nav_3_10" id="__nav_3_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Resilience Patterns
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_10">
            <span class="md-nav__icon md-icon"></span>
            Resilience Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../retry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../circuit_breaker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Circuit Breaker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rate_limiter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rate Limiter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../timeout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timeout & Cancellation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bulkhead/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bulkhead
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fallback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fallback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../locking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Locking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../idempotency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Idempotency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../leasing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distributed Leasing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sharding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workload Sharding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backpressure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backpressure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backoff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exponential Backoff
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Sagas
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Sagas
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-models" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-orchestration-command-based" class="md-nav__link">
    <span class="md-ellipsis">
      1. Orchestration (Command-Based)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-choreography-event-based" class="md-nav__link">
    <span class="md-ellipsis">
      2. Choreography (Event-Based)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-how-to-define-a-saga" class="md-nav__link">
    <span class="md-ellipsis">
      1. How to Define a Saga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-how-to-execute-a-saga" class="md-nav__link">
    <span class="md-ellipsis">
      2. How to Execute a Saga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-implementing-participants-for-choreography" class="md-nav__link">
    <span class="md-ellipsis">
      3. Implementing Participants (for Choreography)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      SagaBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.add_step" class="md-nav__link">
    <span class="md-ellipsis">
      add_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      build
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager" class="md-nav__link">
    <span class="md-ellipsis">
      SagaManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.participant.saga_participant" class="md-nav__link">
    <span class="md-ellipsis">
      saga_participant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext" class="md-nav__link">
    <span class="md-ellipsis">
      SagaContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.payload" class="md-nav__link">
    <span class="md-ellipsis">
      payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.saga_id" class="md-nav__link">
    <span class="md-ellipsis">
      saga_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.complete_step" class="md-nav__link">
    <span class="md-ellipsis">
      complete_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.fail_and_compensate" class="md-nav__link">
    <span class="md-ellipsis">
      fail_and_compensate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.models.SagaState" class="md-nav__link">
    <span class="md-ellipsis">
      SagaState
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../adaptive_throttling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adaptive Throttling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#execution-models" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-orchestration-command-based" class="md-nav__link">
    <span class="md-ellipsis">
      1. Orchestration (Command-Based)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-choreography-event-based" class="md-nav__link">
    <span class="md-ellipsis">
      2. Choreography (Event-Based)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-how-to-define-a-saga" class="md-nav__link">
    <span class="md-ellipsis">
      1. How to Define a Saga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-how-to-execute-a-saga" class="md-nav__link">
    <span class="md-ellipsis">
      2. How to Execute a Saga
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-implementing-participants-for-choreography" class="md-nav__link">
    <span class="md-ellipsis">
      3. Implementing Participants (for Choreography)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      SagaBuilder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.add_step" class="md-nav__link">
    <span class="md-ellipsis">
      add_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.builder.SagaBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      build
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager" class="md-nav__link">
    <span class="md-ellipsis">
      SagaManager
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.manager.SagaManager.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.participant.saga_participant" class="md-nav__link">
    <span class="md-ellipsis">
      saga_participant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext" class="md-nav__link">
    <span class="md-ellipsis">
      SagaContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SagaContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.payload" class="md-nav__link">
    <span class="md-ellipsis">
      payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.saga_id" class="md-nav__link">
    <span class="md-ellipsis">
      saga_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.complete_step" class="md-nav__link">
    <span class="md-ellipsis">
      complete_step
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.context.SagaContext.fail_and_compensate" class="md-nav__link">
    <span class="md-ellipsis">
      fail_and_compensate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nala.fortify.resilience.sagas.models.SagaState" class="md-nav__link">
    <span class="md-ellipsis">
      SagaState
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="sagas-for-distributed-transactions">Sagas for Distributed Transactions</h1>
<h2 id="overview">Overview</h2>
<p>The Saga pattern is an advanced resilience mechanism for managing data consistency across multiple services in a distributed transaction. Unlike traditional (ACID) transactions, which are not feasible in a microservices architecture, a saga is a sequence of local transactions where each step is coordinated with the next.</p>
<p>If any step in the sequence fails, the saga executes a series of compensating actions in reverse order to undo the work that was already completed, thus maintaining overall data consistency.</p>
<p>Fortify provides a complete framework for defining, executing, and recovering sagas, supporting two distinct execution models: <strong>Orchestration</strong> and <strong>Choreography</strong>.</p>
<hr />
<h2 id="core-concepts">Core Concepts</h2>
<ul>
<li><strong>Saga Definition</strong>: A static blueprint of the entire business transaction, created using the <code>SagaBuilder</code>.</li>
<li><strong>Step</strong>: A single, atomic operation within the saga. Each step consists of an <strong>Action</strong> and a <strong>Compensation</strong>.</li>
<li><strong>Action</strong>: A forward-moving operation that performs a task (e.g., <code>reserve_inventory</code>).</li>
<li><strong>Compensation</strong>: An operation that semantically undoes an Action (e.g., <code>release_inventory</code>).</li>
<li><strong>Saga State</strong>: The dynamic, persisted state of a single running saga instance. It tracks the current step, the business payload, and the history of executed steps.</li>
</ul>
<hr />
<h2 id="execution-models">Execution Models</h2>
<h3 id="1-orchestration-command-based">1. Orchestration (Command-Based)</h3>
<p>In this model, a central <strong><code>OrchestrationSagaExecutor</code></strong> manages the entire flow. It directly calls the action handlers for each step in sequence. If any action fails, the orchestrator is responsible for calling the corresponding compensation handlers in reverse order.</p>
<ul>
<li><strong>Pros</strong>: Simple to understand, centralized logic, explicit control flow.</li>
<li><strong>Cons</strong>: Can lead to a "god object" orchestrator if the saga is very complex.</li>
</ul>
<h3 id="2-choreography-event-based">2. Choreography (Event-Based)</h3>
<p>In this model, there is no central orchestrator. The <code>ChoreographySagaExecutor</code> simply starts the saga by publishing the first action as a command/event on the message bus.</p>
<p>Each step is then handled by an independent service (a "participant") that subscribes to its relevant event. After completing its local transaction, the participant uses the injected <code>SagaContext</code> to publish the command/event for the <em>next</em> step. Compensation also flows via events.</p>
<ul>
<li><strong>Pros</strong>: Highly decoupled, services have no direct knowledge of each other.</li>
<li><strong>Cons</strong>: Can be harder to debug and visualize the end-to-end flow.</li>
</ul>
<hr />
<h2 id="1-how-to-define-a-saga">1. How to Define a Saga</h2>
<p>Regardless of the execution model, you define a saga using the fluent <code>SagaBuilder</code>.</p>
<pre><code class="language-python"># In your_app/sagas.py
from nala.fortify.resilience.sagas import SagaBuilder, saga_definition_registry

# Define the blueprint for an &quot;create_order&quot; saga
create_order_saga = SagaBuilder(name=&quot;create_order_saga&quot;) 
    .add_step(
        name=&quot;reserve_inventory&quot;,
        action=&quot;tasks.inventory.reserve_stock&quot;,
        compensation=&quot;tasks.inventory.release_stock&quot;
    ) 
    .add_step(
        name=&quot;process_payment&quot;,
        action=&quot;tasks.payment.charge_card&quot;,
        compensation=&quot;tasks.payment.refund_charge&quot;
    ) 
    .add_step(
        name=&quot;update_order_status&quot;,
        action=&quot;tasks.orders.set_order_approved&quot;,
        compensation=&quot;tasks.orders.set_order_failed&quot;
    ) 
    .build()

# Register the definition so the SagaManager can find it
saga_definition_registry.register(create_order_saga)
</code></pre>
<p>The <code>action</code> and <code>compensation</code> strings are identifiers that the executor will resolve into callable functions or tasks.</p>
<h2 id="2-how-to-execute-a-saga">2. How to Execute a Saga</h2>
<p>You start a new saga instance using the <code>SagaManager</code>.</p>
<pre><code class="language-python">from nala.fortify.resilience.sagas import SagaManager

async def handle_create_order_request(order_details: dict):
    saga_manager = SagaManager()

    initial_payload = {
        &quot;order_id&quot;: order_details[&quot;id&quot;],
        &quot;customer_id&quot;: order_details[&quot;customer_id&quot;],
        &quot;amount&quot;: order_details[&quot;total_price&quot;]
    }

    # This call will block until the saga completes or fails
    final_state = await saga_manager.execute(
        saga_name=&quot;create_order_saga&quot;,
        initial_payload=initial_payload
    )

    return final_state
</code></pre>
<h2 id="3-implementing-participants-for-choreography">3. Implementing Participants (for Choreography)</h2>
<p>If you are using the <strong>Choreography</strong> model, each action and compensation handler is a message consumer decorated with <code>@saga_participant</code>. The decorator injects a <code>SagaContext</code> object, which provides methods to safely advance or compensate the saga.</p>
<pre><code class="language-python"># In your inventory service's consumers
from nala.fortify.resilience.sagas import saga_participant, SagaContext

@subscribe_to(&quot;tasks.inventory.reserve_stock&quot;)
@saga_participant()
async def reserve_stock_handler(context: SagaContext):
    try:
        inventory = await inventory_service.reserve(context.payload)

        # Action succeeded: update the payload and complete the step.
        # This will automatically publish the next event (&quot;tasks.payment.charge_card&quot;).
        await context.complete_step(updated_payload={&quot;inventory_info&quot;: inventory})

    except Exception as e:
        # Action failed: initiate the compensation flow.
        # This will publish the first compensation event (&quot;tasks.inventory.release_stock&quot;).
        await context.fail_and_compensate(error_details=str(e))
</code></pre>
<hr />
<h2 id="configuration">Configuration</h2>
<p>The saga system is configured under the <code>[resilience.sagas]</code> section in your <code>settings.toml</code>.</p>
<pre><code class="language-toml">[default.resilience.sagas]
enabled = true

# Choose the execution model: &quot;orchestration&quot; or &quot;choreography&quot;
executor_type = &quot;orchestration&quot;

# The name of the KVStore connection used for persisting saga state.
kv_store_connection_name = &quot;default_redis&quot;

  # Configuration for the &quot;Reaper&quot; service, which recovers stalled sagas.
  [default.resilience.sagas.reaper]
  enabled = true
  poll_interval_seconds = 300 # Check every 5 minutes
  stalled_threshold_seconds = 900 # A saga is stalled if not updated for 15 minutes
</code></pre>
<hr />
<h2 id="api-reference">API Reference</h2>


<div class="doc doc-object doc-class">



<h2 id="nala.fortify.resilience.sagas.builder.SagaBuilder" class="doc doc-heading">
            <code>nala.fortify.resilience.sagas.builder.SagaBuilder</code>


</h2>


    <div class="doc doc-contents first">


        <p>A fluent builder for creating immutable SagaDefinition objects.</p>
<p>This class provides a declarative, chainable API for defining the sequence
of steps, actions, and compensations that constitute a distributed transaction.</p>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.builder.SagaBuilder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the builder for a new saga definition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unique name for the saga, used for identification and logging.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.builder.SagaBuilder.add_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_step</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">compensation</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds a new step to the saga sequence.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A human-readable name for the step.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An identifier for the function/task that performs the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An identifier for the function/task that compensates the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="nala.fortify.resilience.sagas.builder.SagaBuilder" href="#nala.fortify.resilience.sagas.builder.SagaBuilder">SagaBuilder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The builder instance to allow for method chaining.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.builder.SagaBuilder.build" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Constructs and returns the final, immutable SagaDefinition object.</p>
<p>Once built, the definition should not be altered.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="nala.fortify.resilience.sagas.models.SagaDefinition">SagaDefinition</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A configured and validated SagaDefinition instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nala.fortify.resilience.sagas.manager.SagaManager" class="doc doc-heading">
            <code>nala.fortify.resilience.sagas.manager.SagaManager</code>


</h2>


    <div class="doc doc-contents first">


        <p>The main entry point and public interface for the Saga distributed transaction framework.</p>
<p>This manager is responsible for initiating a saga run by resolving the static
<code>SagaDefinition</code> and delegating the entire execution lifecycle (forward actions
and compensation) to the configured <code>SagaExecutorProtocol</code>.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.manager.SagaManager.executor">executor</span></code></td>
            <td>
                  <code><span title="nala.fortify.resilience.sagas.protocols.SagaExecutorProtocol">SagaExecutorProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The saga executor responsible for running the process (e.g., Orchestration or Choreography).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.manager.SagaManager.registry">registry</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The repository holding registered saga definitions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.manager.SagaManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">executor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the SagaManager.</p>
<p>It automatically resolves and injects the <code>SagaStateRepository</code> and the
appropriate <code>SagaExecutor</code> implementation if one is not provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>executor</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="nala.fortify.resilience.sagas.protocols.SagaExecutorProtocol">SagaExecutorProtocol</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional, pre-configured
                                      saga executor instance for dependency injection in tests.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.manager.SagaManager.execute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">execute</span><span class="p">(</span><span class="n">saga_name</span><span class="p">,</span> <span class="n">initial_payload</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Initiates a new instance of a registered saga.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>saga_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unique name of the saga definition to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_payload</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The business data required to start the transaction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SagaState</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="nala.fortify.resilience.sagas.models.SagaState" href="#nala.fortify.resilience.sagas.models.SagaState">SagaState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The final state object of the saga upon completion or failure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="nala.fortify.resilience.sagas.exceptions.SagaError">SagaError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the saga definition cannot be found in the registry.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="nala.fortify.resilience.sagas.participant.saga_participant" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nala</span><span class="o">.</span><span class="n">fortify</span><span class="o">.</span><span class="n">resilience</span><span class="o">.</span><span class="n">sagas</span><span class="o">.</span><span class="n">participant</span><span class="o">.</span><span class="n">saga_participant</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents first">

        <p>Decorator for a message consumer function to designate it as a participant
in a choreographed saga.</p>
<p>This decorator handles the necessary boilerplate for saga participation:
1. Extracts the <code>saga_id</code> from the incoming message.
2. Loads the current <code>SagaState</code> from the repository.
3. Validates that the saga is in a runnable state (RUNNING or COMPENSATING).
4. Injects a rich <code>SagaContext</code> object into the decorated function, which
   allows the handler to safely advance or compensate the saga.</p>


    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nala.fortify.resilience.sagas.context.SagaContext" class="doc doc-heading">
            <code>nala.fortify.resilience.sagas.context.SagaContext</code>


</h2>


    <div class="doc doc-contents first">


        <p>An active context object injected into saga participant handlers.</p>
<p>It holds the current, mutable state of the saga and provides high-level
methods to safely transition the saga's state (advance or fail/compensate),
abstracting away the underlying repository and messaging infrastructure.</p>











  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="nala.fortify.resilience.sagas.context.SagaContext.payload" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">payload</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the mutable business payload associated with the saga.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="nala.fortify.resilience.sagas.context.SagaContext.saga_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">saga_id</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the unique ID of the current saga instance.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.context.SagaContext.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">repository</span><span class="p">,</span> <span class="n">producer</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the SagaContext.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="nala.fortify.resilience.sagas.models.SagaState" href="#nala.fortify.resilience.sagas.models.SagaState">SagaState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current, mutable state of the running saga instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>definition</code>
            </td>
            <td>
                  <code><span title="nala.fortify.resilience.sagas.models.SagaDefinition">SagaDefinition</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The static blueprint defining the steps of the saga.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>repository</code>
            </td>
            <td>
                  <code><span title="nala.fortify.resilience.sagas.protocols.SagaStateRepositoryProtocol">SagaStateRepositoryProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The persistence layer for state updates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>producer</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="nala.fortify.integration.messaging.producers.protocol.ProducerProtocol (nala.fortify.integration.messaging.ProducerProtocol)" href="../../integration/messaging/producer/#nala.fortify.integration.messaging.producers.protocol.ProducerProtocol">ProducerProtocol</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The messaging component used to publish events (commands).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.context.SagaContext.complete_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complete_step</span><span class="p">(</span><span class="n">updated_payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Marks the current step as succeeded and triggers the next action in the saga chain.</p>
<p>If this is the final step, the saga status is set to <code>COMPLETED</code>. Otherwise,
the next action is published as an event via the producer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>updated_payload</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary to update
                                        or merge into the saga's persistent payload.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nala.fortify.resilience.sagas.context.SagaContext.fail_and_compensate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fail_and_compensate</span><span class="p">(</span><span class="n">error_details</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Marks the current step as failed, initiates the compensation flow, and
publishes the first compensation event.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_details</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A message detailing the reason for the failure.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nala.fortify.resilience.sagas.models.SagaState" class="doc doc-heading">
            <code>nala.fortify.resilience.sagas.models.SagaState</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Represents the dynamic, persisted state of a single, running saga instance.</p>
<p>This is the core model managed by the <code>SagaStateRepository</code>, tracking the
saga's progress, status, and accumulated payload.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.saga_id">saga_id</span></code></td>
            <td>
                  <code><span title="uuid.UUID">UUID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unique instance ID of the running saga.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.saga_name">saga_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the saga definition used to start this instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.status">status</span></code></td>
            <td>
                  <code><span title="nala.fortify.resilience.sagas.models.SagaStatus">SagaStatus</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current state of the saga (RUNNING, COMPLETED, etc.).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.current_step">current_step</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the last or currently executing step in the definition.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.payload">payload</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mutable business data for the transaction, updated by steps.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.context">context</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The propagated <code>ExecutionContext</code> (e.g., <code>trace_id</code>, <code>tenant_id</code>) captured at initiation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.step_history">step_history</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="nala.fortify.resilience.sagas.models.SagaStepHistory">SagaStepHistory</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An ordered log of execution attempts for each step.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The UTC time when the saga instance was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="nala.fortify.resilience.sagas.models.SagaState.updated_at">updated_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The UTC time of the last state update (used by the reaper service).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











  <div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Nala Minds
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.annotate", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>